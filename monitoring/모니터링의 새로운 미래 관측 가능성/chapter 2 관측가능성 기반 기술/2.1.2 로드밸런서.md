<!-- Date: 2025-02-16 -->
<!-- Update Date: 2025-02-16 -->
<!-- File ID: 2f4ebf62-e161-4bce-bd2f-c776b1efcf72 -->
<!-- Author: Seoyeon Jang -->

# 📌 관측 가능성 기반 기술 - 로드밸런서
복원성이 뛰어나고 탄력적인 네트워크를 구축하기 위해서는 **로드 밸런서** 가 필요하다. 클라우드와 쿠버네티스를 도입함으로써 네트워크 구조가 복잡해졌다. 그로 인해 `여러 개의 DNS서버`와 `여러 유형의 로드밸런서`를 구성하는 것이 일반적이다.

다음과 같은 방식으로 다층 구조의 로드밸런서를 구성할 수 있다.

1. DNS 로드밸런서
   - 여러 개의 서버 IP를 DNS 레코드에 등록하여 트래픽을 분산(ex: Route 53, Cloud DNS)
   - 클라이언트가 도메인 (URL)을 요청하면, DNS가 여러 서버 중 하나의 IP를 반환

    >예시:
    > 사용자가 `example.com`에 접속하면 DNS가 여러 서버 중 하나의 IP를 제공하여 트래픽을 분사

2. 네트워크 로드밸런서(L4, Layer 4)
    - TCP, UDP 프로토콜 수준에서 트래픽을 분산 (ex: AWS NLB)
    - 클라이언트와 서버 간 IP, 포트 기반으로 로드밸런싱
    - 빠른 속도 & 낮은 지연 시간 (L7보다 단순한 처리방식)
   > 예시:
   > TCP 포트(80, 443) 기반으로 여러 서버로 요청을 분산

3. 애플리케이션 로드밸런서 (L7, Layer 7)
    - HTTP/HTTPS 프로토콜을 기반으로 요청을 분석하여 라우팅 (ex: AWS ALB)
    - 요청 URL, 쿠키, 헤더 등을 분석해 세밀한 분산처리 가능
   > 예시:
   > `/api` 요청은 서버 A로, `/static` 요청은 서버 B 로 전달

4. 쿠버네티스의 로드밸런서
   쿠버네티스에서는 Service 와 Ingress 를 활용한 로드밸런싱을 지원한다.
   
   | 방식           | 설명                            |
   |--------------|-------------------------------|
   | ClusterIP    | 쿠버네티스 내부에서만 접근 가능한 기본 네트워크 방식 |
   | NodePort     | 각 노드의 특정 포틀르 통해 외부에서 접근 가능    |
   | LoadBalancer | 클라우드의 로드밸런서를 자동으로 연결          |
   | Ingress      | HTTP(S) 트래픽을 여러 서비스로 라우팅      |
   

### 로드 밸런서 활용 에시
### 예제 시나리오: AWS 클라우드에서 트래픽을 분산하는 구조
1. Route 53 (DNS 로드밸런서)
   - example.com을 요청하면 여러 데이터센터 중 하나를 선택
2. AWS Application Load Balancer (L7)
   - `/api/*` 요청은 API 서버로, `/web/*` 요청은 웹서버로 라우팅
3. AWS Network Load Balancer (L4)
   - 백엔드의 여러 애플리케이션 서버로 TCP/UDP 트래픽을 분산
4. 쿠버네티스 Ingress
   - API 요청을 특정 Pod(컨테이너)로 전달
   

- AWS 기반의 네트워크 흐름을 설명하면 외부에서 유입되는 트래픽은 AWS NAT 게이트웨이를 통해 VPC로 유입된다. VPC의 내부는 다수의 서브넷으로 구성된다.
- 트래픽은 서브넷에서 AWS 일래스틱 로드 밸런서를 경유하며 쿠버네티스 인그레스로 유입된다. 그리고 쿠버네티스 인그레스의 경로에 맞게 특정 애플리케이션으로 라우팅되는 것이 일반적인 네트워크 처리 경로다.
- 쿠버네티스는 자체적인 로드밸런서(쿠브 프록시)와 DNS 서버를 가지고 잇으며, 이를 정확히 이해하지 않으면 네트워크 장애발생시 문제해결이 쉽지 않다. CoreDNS를 통해 서비스를 찾아내고 쿠브 프록시를 통해 특정 파드로 로드밸런싱을 한다.
