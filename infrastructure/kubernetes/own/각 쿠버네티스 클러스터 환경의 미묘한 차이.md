<!-- Date: 2025-02-05 -->
<!-- Update Date: 2025-02-05 -->
<!-- File ID: ff6f77b2-96d0-42be-a8eb-7fcd4fa5f76d -->
<!-- Author: Seoyeon Jang -->

# 개요
쿠버네티스 클러스터는 어디서나 같은 방식으로 동작할까?

**사실 환경에 따라 미묘한 차이가 존재한다.** 클러스터를 구축하는 방법에 따라 네트워크 동작 방식이 달라지고, 서비스 타입(LoadBalancer, NodePort 등)의 지원 여부도 변한다.

그렇다면 쿠버네티스 클러스터를 구축할 수 있는 환경에는 어떤 것이 있으며, 각 환경에서의 차이는 무엇일까?

## 쿠버네티스 클러스터를 구축할 수 있는 환경

쿠버네티스를 실행할 수 있는 대표적인 환경에는 **로컬 개발용 클러스터**와 **클라우드 매니지드 서비스**가 있다. 각 환경의 특징과 서비스 동작 방식을 살펴보자.

### 1. Docker Desktop (도커 데스크탑 쿠버네티스)

Docker Desktop은 **로컬 개발 환경**에서 컨테이너를 실행하는 대표적 도구다. 쿠버네티스 클러스터를 내장하고 있어서, 간단한 설정만으로 **단일 노드 쿠버네티스** 실행할 수 있다.

- 장점: 설치가 간편하고, 개발 및 테스트 용도로 적합
- 단점: 단일 노드만 지원하므로, 고가용성 테스트는 불가능
- 서비스 타입 동작
    - `LoadBanlancer` -> 지원하지 않음(추가 설정 필요)
        - 지원하지 않는 이유?
            1. **클라우드 로드밸런서와의 연동 부족**
                - 쿠버네티스에서 `LoadBalancer`타입의 서비스는 일반적으로 클라우드 환경에서 사용되며, 클라우드 공급자가 제공하는 로드밸런서를 자동으로 생성하는 방식이다.
                - 하지만 도커 데스크톱은 로컬에서 실행되는 쿠버네티스 클러스터이므로, 클라우드 로드밸런서를 자동으로 할당할 수 없다.
            2. **로컬 네트워크에서 공인 IP 할당 불가**
                - 클라우드의 `LoadBanlancer`서비스는 공인 IP를 할당하여 외부에서 접근할 수 있도록 한다.
                - 그러나 도커 데스크톱의 쿠버네티스의 경우 로컬 환경에서 실행되기 때문에, 공인 IP를 자동으로 할당할 수 있는 인프라가 존재하지 않는다.
                - 로컬 머신에서 공인 IP를 제공하는 것은 보안문제를 일으킬 수 있음.
            3. **MetalLB** 등의 별도 솔루션 필요
                - 클라우드 환경이 아닌 환경(예: 온프렘, 로컬)에서 `LoadBalancer`를 사용하려면 MetalLB 같은 **소프트웨어 기반의 로드밸런서를 직접 설치해야 한다.**
                - MetalLB는 로컬 환경에서도 `LoadBalancer`타입의 서비스를 지원하도록 BGP 또는 Layer 2 모드를 사용해 로드밸런서를 제공할 수 있다.
    - `NodePort` -> `localhost:<NodePort>`로 접근

### 2. Minikube (미니큐브)

가상머신으로 동작하는 쿠버네티스 클러스터이다.

- 장점: 로컬에서 `LoadBalancer` 지원 가능
- 단점: 기본적으로 단일 노드라서 실제 프로덕션과는 차이가 있음
- 서비스 타입 동작
    - `LoadBalancer` -> `minikube tunnel` 실행시 지원 가능
    - `NodePort` -> `minikube ip:<NodePort>` 로 접근

#### 실행방법

1. minikube 클러스터 시작
    ```shell
    $ minikube start
    ```
2. NodePort 서비스 실행 후 접근
    ```shell
    $ minikube ip # Minikube의 IP 확인
    $ curl http://<Minikube-IP>:<NodePort>
    ```

### 3. Kind (Kubernetes in Docker)

Kind는 Docker 컨테이너 안에서 쿠버네티스 클러스터를 실행하는 도구다. 도커 데스크탑은 단일 노드 클러스터로 기본 동작하지만, Kind는 여러 Docker 컨테이너를 사용해 쿠버네티스 클러스터를 구성하며,
다수의 노드로 K8S 클러스터를 실험할 수 있다. 즉 여러 노드로 클러스터를 구성하여 테스트할 수 있는 것이다.

- 장점: 다중 노드 설정이 가능
- 단점: 네트워크 설정이 복잡할 수 있음
- 서비스 타입 동작
    - `LoadBalancer` -> 지원하지 않음
    - `NodePort` -> `kind get kubeconfig` 설정이 필요

### 3. 클라우드 매니지드 서비스(EKS, GKE, AKS 등)

클라우드 서비스 제공업체가 관리하는 쿠버네티스 환경이다. 클러스터 설치 및 유지보수를 잦동으로 처리해주며, **프로덕션 환경에 적합하다.**

- 장점
    - 관리가 편리하고, Auto Scaling 및 고가용성 지원
- 서비스 타입 동작
    - `LoadBalancer` -> 클라우드에서 자동 프로비저닝
    - `NodePort` -> 퍼블릭 노드 IP 사용

# 정리
쿠버네티스 클러스터는 환경에 따라 동작 방식이 다르므로, 목적에 맞는 환경을 선택하는 것이 중요하다.

- 개발 및 로컬 테스트 -> Docker Desktop, Minikube, Kind
- 프로덕션 운영 -> 클라우드 매니지드 서비스


