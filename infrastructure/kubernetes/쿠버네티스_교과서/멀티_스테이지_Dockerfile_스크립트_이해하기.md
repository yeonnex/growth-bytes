<!-- Date: 2025-01-05 -->
<!-- Update Date: 2025-01-05 -->
<!-- File ID: 478f610f-2f6c-4366-b9d5-65db195f085c -->
<!-- Author: Seoyeon Jang -->

# 개요

자바앱, 노드앱, Go앱을 모두 도커 빌드하여 이미지를 만들고 컨테이너화하여 실행해보았다. 마지막으로, 멀티스테이지 Dockerfile 스크립트의 동작 원리와
컨테이너 안에서 애플리케이션을 빌드하는 것이 왜 유용한지를 설명하며 마무리하겠다.

## 표준화

**첫번째 장점은 표준화다.** 이 책의 필자는 독자가 예제 이미지를 모두 성공적으로 빌드할 수 있으리라는 것을 안다.
그 이유는 필자와 독자가 모두 같은 도구를 사용했기 때문이다. 독자가 어떤 운영체제를 사용하든, 그리고 로컬 컴퓨터에 어떤 도구를 설치했는지와 상관없이
모든 빌드 과정은 도커 컨테이너 내부에서 이뤄진다. 그리고 이들 컨테이너는 모든 도구를 **정확한 버전으로 갖추고 있다.** 이것을 실무에 적용한다면
신규 개발자의 적응 기간이나 빌드 서버의 관리 부담, 혹은 개발자 간 도구 버전의 차이로 인한 빌드 실패를 크게 줄일 수 있을 것이다.

## 성능향상

**두번째 장점은 성능 향상이다.** 멀티 스테이지 빌드의 각 단계는 자신만의 캐시를 따로 갖는다.
그리고 도커는 빌드 중에 각 인스트럭션에 해당하는 레이어 캐시를 찾는다. 해당되는 캐시를 찾지 못하면 남은 인스트럭션이 모두 실행되지만,
그 범위가 해당 단계 안으로 국한된다. 이어지는 다음 단계는 다시 캐시를 재사용하면서 시작할 수 있다. 처음에 Dockerfile 스크립트를 세심하게 최적화해서
작성한다면 이후로 캐시 재사용을 통해 90% 이상의 빌드 단계에서 시간을 절약할 수 있다.

마지막으로 언급할 장점은 멀티 스테이지 Dockerfile 스크립트를 통해 빌드 과정을 세밀하게 조정하며 최종 산출물인 이미지를 가능한 작게 유지할 수 있다는 것이다.
비단 컴파일러에만 국한된 내용은 아니다. 어떤 도구든지 그 도구가 사용되는 단계만으로 도구의 포함 여부를 국한시킬 수 있다. 최종 산출물인 이미지에 불필요한 도구는
빼버릴 수 있는 것이다. 이 좋은 예가 curl 이다.
curl 은 인터넷을 통해 필요한 파일을 내려받을 수 있는 중요한 도구이지만, 파일 다운로드를 빌드 초기 단계에 모아 놓는다면 최종 이미지에는 curl을 포함시키지 않아도
된다. 이런 방법으로 이미지 크기를 줄여서 애플리케이션의 시작 시간을 단축할 수 있으며, 애플리케이션의 의존 모듈 자체를 줄여 취약점을 이용한 외부의 공격 가능성도 최대한
차단할 수 있다.

## Dockerfile 을 만났을 때 점검해야 할 것!

!!! AS builder 로 다단계 빌드를 적용해 빌드 이미지와 최종 이미지가 분리되었는가?

- **빌드 단게와 실행단계를 분리**하여, 빌드에 필요한 도구(golang)만 포함된 빌드 이미지를 사용하고, 실행에 필요한 최소한의 파일만 포함된 최종
  이미지를 생성해야 한다.

# 정리


