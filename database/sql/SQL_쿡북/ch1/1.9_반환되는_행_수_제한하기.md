<!-- Date: 2025-01-06 -->
<!-- Update Date: 2025-01-06 -->
<!-- File ID: 6b312437-fae7-4222-b1ac-f1d4c0390311 -->
<!-- Author: Seoyeon Jang -->

# 개요

문제: 쿼리에서 반환되는 행 수를 제한하려고 한다. 순서는 상관없으며 몇 개의 행이든 가능하다.

해법: 데이터베이스에서 제공하는 **내장함수**를 사용하여 반환되는 행 수를 제어한다.

> DB2

**FETCH FIRST**절을 사용한다.

```sql
select *
from emp fetch first 5 rows only
```

> MySQL과 PostgreSQL

LIMIT를 사용한다.

```sql
select *
from emp
limit 5
```

> Oracle

**WHERE** 절에서 **ROWNUM**으로 반환되는 행 수를 제한한다.

```sql
select *
from emp
where rownum <= 5;
```

> SQL Server

**TOP**키워드를 사용하여 반환되는 행 수를 제한한다.

```sql
select top 5 *
from emp;
```

설명: 많은 벤더는 **FETCH FIRST** 및 **LIMIT**과 같은 절을 제공하여 쿼리에서 반환할 행 수를 지정할 수 있다.
다만 Oracle에서 사용하는 **ROWNUM**이라는 함수는 반환되는 각 행에 대해 숫자를 반환한다는 점에서 다르다(1에서 시작하는 증가값이다).

다음은 **ROWNUM <= 5**를 사용하여 처음 5개의 행을 반환할 때 발생하는 작동 흐름이다.

1. Oracle이 쿼리를 실행한다.
2. Oracle은 첫번째 행을 가져오고, 첫번째 행이라고 부른다.
3. 5행을 지났는가? 아니라면 Oracle은 번호가 5이하인 기준을 충족하므로 행을 반환한다. 맞다면 Oracle은 행을 반환하지 않는다.
4. Oracle은 다음 행을 가져와서 행 번호를 매긴다(2,3,4 등).
5. 단계 3으로 이동한다.

이 프로세스에서 알 수 있듯, 각 행을 가져온 뒤에 Oracle에서의 **ROWNUM**값이 할당된다.
이것이 중요한 핵심 포인트다. 대부분의 Oracle 개발자는 **ROWNUM = 5**를 지정하여 쿼리에서 다섯번째 행만 반환하려고 한다.

**ROWNUM**과 동등 조건을 사용하는 것은 좋지 않다. 다음은 **ROWNUM = 5**를 사용하여 다섯번째 행을 반환하려고 할 때 발생하는 작동이다.

1. Oracle이 쿼리를 실행한다.
2. Oracle은 첫번째 행을 가져오고, 첫번째 행이라고 부른다.
3. 5행에 도달했는가? 아니라면 Oracle은 기준을 충족하지 않으므로 행을 삭제한다. 맞다면 Oracle은 행을 반환한다. 그러나 해답은 결코 '예'가 될 수 없다!
4. Oracle은 다음 행을 가져와서 이를 첫번째 행이라고 부른다. 쿼리에서 반환되는 첫번째 행은 1로 번호가 지정되어야 하기 때문이다.
5. 단계 3으로 이동한다.

이 프로세스를 자세히 살펴보면 **ROWNUM = 5**를 사용하여 다섯번째 행을 반환하는 데 실패한 원인을 알 수 있다. 1행부터 4행까지 먼저 반환하지 않으면 다섯번째
행을 가질 수 없는데, 이 프로세스는 영원히 5를 가져올 수 없다.

**ROWNUM = 1**이 실제로 첫번째 행을 반환하는 작업을 수행한다는 점을 알 수 있다.

# 정리


