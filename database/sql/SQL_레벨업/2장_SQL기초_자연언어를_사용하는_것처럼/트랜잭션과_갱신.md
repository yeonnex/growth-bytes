<!-- Date: 2025-01-24 -->
<!-- Update Date: 2025-01-24 -->
<!-- File ID: 7009e758-7aa7-4ac3-97a0-2b9c7c58e1ac -->
<!-- Author: Seoyeon Jang -->

# 개요

SQL은 'Structured Query Language'의 약자이다. 'Query'는 '질의'를 나타내며 좁은 뜻으로는 SELECT 구문을 나타낸다. 이름에서 알 수 있듯 SQL은 처음부터 데이터 검색을 중심으로
수행하기 위한 언어이다. 한마디로 데이터를 갱신하는 것은 부가적인 기능이라는 것이다.

역사적으로도 SQL의 검색 기능은 점점 추가되면서 복잡해졌다. 하지만 갱신 기능은 복잡하지 않다.

기본적으로 SQL의 갱신 작업은 다음 세 종류로 분류한다.

-
    1. 삽입(insert)
-
    2. 제거(delete)
-
    3. 갱신(update)

이 외에도 1과 3을 합친 머지(MERGE)라는 갱신 기능도 있지만, 일단은 위의 3개 기능을 우선 알아보자.

## INSERT 로 데이터 삽입

RDB는 데이터를 테이블에 보관한다. 테이블은 데이터를 보관하는 상자에 지나지 않으므로 내부에 데이터가 없으면 사용하는 의미가 없다.

RDB에서 데이터를 등록하는 단위는 레코드(행)이다. 기본적인 등록 단위는 하나의 레코드씩이다. 이때 사용하는 것이 INSERT구문이다. 문자 그대로 레코드를 '삽입'한다.

```shell
INSERT INTO [테이블이름] ([필드1],[필드2],[필드3], ...) VALUES ([값1],[값2], [값3] ...);
```

이때 필드 리스트와 값 리스트는 같은 순서로 대응하게 입력해야 한다.

최근에는 여러 개의 레코들르 한 개의 INSERT 구문으로 삽입하는 기능(multi-row insert)을 지원하는 DBMS도 있다.
address 테이블에 3개의 데이터를 한꺼번에 삽입하면 다음과 같이 하면 된다.

```sql
INSERT INTO address (name, phone_nbr, address, sex, age)
VALUES ('인성', '010-1111-2222', '서울시', '남', 30),
       ('준', '010-1111-3333', '부산시', '남', 21),
       ('하린', '010-1111-4444', '서귀포시', '여', 37);
```

이 방법은 간단하고 한 번만 구문을 실행하면 된다는 점에서 좋다. 하지만 모든 DBMS나 낮은 버전에서 사용할 수 있는 건 아니니 확인하고 사용해야 한다. 또한 오류가 발생했을 때 어떤 레코드가 문제인지 확인하기
어렵다는 단점도 있다.

## DELETE 로 데이터 제거

데이터를 삽입하는 기능이 있으므로 반대로 데이터를 삭제하는 기능도 있다. 그런데 데이터를 삭제할 때는 하나의 레코드가 아니라 한 번에 여러개의 레코드 단위로 처리하게 된다. 어쨌거나 데이터를 제거할 때 사용하는 것이
DELETE 구문이다.

```sql
DELETE
FROM [테이블이름];
```

```sql
DELETE
FROM address;
```

이 SQL은 address 테이블에 들어있는 모든 레코드를 제거한다. 만약 부분적으로만 레코드를 제거하고 싶을 때는 SELECT 구문에서 사용했던 WHERE구로 제거 대상을 선별한다. 예를 들어 주소가 서울시인
사람의 레코드만 삭제하고 싶다면 다음처럼 작성한다.

```sql
DELETE
FROM address
WHERE address = '서울시';
```

**DELETE 구문의 삭제 대상은 필드가 아니라 레코드**이므로 DELETE 뒤에 필드가 오지 않고 바로 FROM 테이블이름이 오는 것이다. 만약 레코드의 필드 일부만 지우고 싶다면 UPDATE 구문을 사용하면
된다.

DELETE 구문으로 모든 데이터를 삭제했다고 테이블 자체가 사라지는 것은 아니다. 테이블이라는 상자 📦는 남아있으므로, 계속해서 INSERT 하여 새로운 데이터를 넣을 수 있다. 테이블 자체를 삭제하고 싶을 때는
DROP TABLE 이라는 명령어를 사용한다.

## UPDATE 로 데이터 갱신

데이터를 수정하고 싶다면 UPDATE 구문을 쓴다.

```sql
UPDATE [테이블이름]
SET
[필드이름] = [식];
```

UPDATE 구문도 일부 레코드만 갱신하고 싶을 때는 DELETE 구문처럼 WHERE 구로 필터링한다. 예를 들어 빛나래의 전화번호가 다르게 등록되어 수정하고 싶다면 WHERE 구로 빛나래만 선택해주면 된다.

```sql
UPDATE address
SET phone_nbr = '010-6639-7777'
WHERE name = '빛나래';
```

UPDATE 구문의 SET 구에 여러 개의 필드를 입력하면, 한번에 여러 개의 값을 변경할 수 있다. 따라서 여러개의 필드를 갱신하고 싶을 때 UPDATE 구문을 여러번 사용할 필요가 없다.

폰번호와 나이를 한번에 수정하는 방법은 다음과 같다.

```sql
UPDATE address
SET phone_nbr = '010-6639-7777',
    age       = 27
WHERE name = '빛나래';
```

# 정리

- 간단하고 직관적으로 작성할 수 있다는 것이 비절차형 언어 SQL의 장점
- CASE 식은 조건 분기를 표현하는 중요한 도구. **포인트는 구문이 아니라 식을 바탕으로 한다는 것**
- 쿼리는 입력과 출력을 모드 테이블에 있는 것을 바탕으로 할 수 있으므로 유연함
- SQL은 GROUP BY, UNION, INSERSECT 등 집합 이론을 바탕으로 만들어진 연산이 많음
- **윈도우 함수는 GROUP BY 구에서 집약 기능을 제외하고 자르는 기능만 남긴 것**

> 연습문제: address 테이블에서 성별 별로 나이 순위(건너뛰기 있게)를 매기는 select 구문을 작성해보자.

```sql
select name,
       age,
       sex,
       rank() over (partition by sex order by age desc) as rnk_within_sex
from address
order by sex;
```


