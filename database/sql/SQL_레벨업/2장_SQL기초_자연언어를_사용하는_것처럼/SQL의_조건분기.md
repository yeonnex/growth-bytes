<!-- Date: 2025-01-22 -->
<!-- Update Date: 2025-01-22 -->
<!-- File ID: 53e942b9-17df-4905-ae94-fbafb45054ce -->
<!-- Author: Seoyeon Jang -->

# SQL과 조건 분기

일반적인 절차 지향형 프로그래밍 언어에는 조건 분기를 사용하기 위한 수단으로 if 조건문과 switch 조건문이 있다.
SQL에도 이런 조건 분기를 하는 방법이 있지만, 사용방법이 약간 다르다. SQL은 코드를 절차적으로 기술하는 것이 아니므로 조건 분기를 '문장' 단위로 하지 않기 때문이다.

그렇다면 SQL의 조건분기는 어떤 단위를 기준으로 할까? 바로 '식' 이다.

## CASE 식의 구문

CASE 식의 구문에는 '단순 CASE 식'과 '검색 CASE 식'이라는 두 종류가 있다. 다만 검색 CASE 식은 단순 CASE 식의 기능을 모두 포함하고 있으므로 검색 CASE 식만 기억해도 충분하다.

```sql
-- 검색 CASE 식의 구문
CASE WHEN [평가식] THEN [식]
    WHEN [평가식] THEN [식]
    WHEN [평가식] THEN [식]
    생략
    ELSE [식]
END
```

## CASE 식의 작동

CASE 식의 작동은 절차 지향형 프로그래밍 언어의 switch 조건문과 거의 비슷하다. 처음에 있는 WHEN 구의 평가식부터 평가되고 조건이 맞으면 THEN 구에서 지정한 식이 리턴되며 CASE 식 전체가
종료된다. 만약 조건이 맞지 않으면 다음 WHEN 구로 이동해 같은 처리를 반복한다. 마지막 WHEN 구까지 반복했는데도 조건이 맞는 경우가 없다면 ELSE 에서 지정한 식이 리턴되며 끝난다.

절차 지향형 언어의 조건 분기와 SQL 조건 분기 사이의 가장 큰 차이점은 바로 **리턴값** 이다. 절차 지향형 언어의 조건 분기는 문장을 실행하고 딱히 리턴하지는 않는다. 반면 SQL의 조건분기는 **특정한 값(
상수)를 리턴한다.**

예제를 살펴보자. 주소의 결과 표시를 시도의 이름이 아니라 '경기', '호남' 처럼 분류하는 경우를 생각해보자.

```sql
select name,
       address,
       CASE
           WHEN address = '서울시' THEN '경기'
           WHEN address = '인천시' THEN '경기'
           WHEN address = '부산시' THEN '영남'
           WHEN address = '속초시' THEN '관동'
           WHEN address = '서귀포시' THEN '호남'
           ELSE null END AS district
from address;
```

이 코드는 일종의 '교환' 이라고 말할 수 있다. '서울시 -> 경기', '부산시 -> 영남'처럼 교환되었다. 일반적으로 CASE 식은 이러한 경우에 많이 사용한다.

CASE 식의 강력한 점은 **식**이라는 점이다. **따라서 식을 적을 수 있는 곳이라면 어디든 적을 수 있다.**
SELECT, WHERE, GROUP BY, HAVING, ORDER BY 구와 같은 곳 어디에나 적을 수 있으므로 다양한 기법으로 활용할 수 있다. CASE 식은 SQL의 성능과도 큰 관련이 있으므로 이후에도 계속
등장하게 될 것이다.

# 정리


