<!-- Date: 2025-01-13 -->
<!-- Update Date: 2025-01-14 -->
<!-- File ID: adbba9c0-e8b9-40b8-9349-a04e5141d698 -->
<!-- Author: Seoyeon Jang -->

# 개요

RDB는 데이터를 관계(relation)이라는 형식으로 저장한다.
구현으로는 **이를 테이블**이라고 한다.
SQL은 프로그래머가 아닌 사람도 사용할 수 있게 하자는 의도로 설계되어, 자연 언어인 영어와 비슷한 구문으로 되어있어
직관적으로 사용할 수 있다.

그렇다고 해도 사실 SQL은 복잡하다. 복잡한 작업을 수행할 때는 '자연 언어를 사용하는 것처럼' SQL을 조작한다고 말하기 힘들다.(게다가 최근
SQL표준에는 굉장히 복잡한 기능이 많이 들어가서...)
또한 내부적인 움직임을 제대로 이해하지 못하면 성능이 안나온다.

현재의 SQL은 RDB를 처음 설계했던 때처럼 쉬운 언어가 아니게 되었다.

어쩄거나, SQL 구문 기초를 알아보자.

## GROUP BY 구

GROUP BY 구를 사용하면, 테이블에서 단순하게 데이터를 선택하는 것뿐만 아니라 합계 또는 평균 등의 집계 연산을 SQL구문으로 할 수 있다.

GROUP BY 구의 기능을 쉽게 표현하면 '테이블을 홀 케이크처럼 다룬다'라고 할 수 있다. 홀케이크는 생일 등에 먹는 둥근 형태의 큰 케이크이다.
GROUP BY 구는 이때 케이크를 자르는 칼과 같은 역할을 한다.

그럼 일단 Address 테이블을 하나의 생일 케이크라고 생각해보자. 물론 무리가 있을 수 있겠지만 최대한 열심히 상상해보자.(파이팅)
대충 그림을 머릿속에 떠올렸다고 하자. 그럼 이제 그 케이크를 칼로 잘라보자.
케이크를 자를 때의 기준은 바로 '필드'이다.
일단 성별을 사용해 남자와 여자라는 두 개로 나눠 잘라보자.

![](.SQL_자연언어를_사용하는_것처럼_images/babafc6b.png)

- **그룹을 나누었을 때의 장점**

예쁘게 두 조각으로 잘렸다. 그런데 대체 케이크를 자르면 뭐가 좋은 걸까? 일단 잘라진 케이크 조각을 **그룹**이라고 부른다.
그리고 이러한 그룹은 다양한 숫자 관련 함수를 사용한 집계가 가능하다.

어떤 집계가 가능한지 SQL의 대표적 함수를 5개 살펴보자.

- COUNT: 레코드 개수 계산
- SUM: 숫자를 더함
- AVG: 숫자의 평균을 구함
- MAX: 최댓값을 구함
- MIN: 최솟값을 구함

예를 들어 남자 그룹과 여자 그룹에 각각 몇 명이 있는지를 구하고 싶다면 다음과 같은 SELECT 구문을 사용한다.

```sql
SELECT sex, COUNT(sex)
FROM address
GROUP BY sex;
```

![](.SQL_자연언어를_사용하는_것처럼_images/e9bdfeda.png)
그럼 이번에는 케이크를 자르는 기준을 변경해보자. 살고 있는 지역을 기준으로 케이크를 자른다면 다음과 같이 될 것이다.
![](.SQL_자연언어를_사용하는_것처럼_images/dca6bc05.png)

지역마다 살고 있는 사람 수가 다르기 때문에 케이크가 좀 이상하게 생기긴 했지만, 이전과 다르지 않다.
앞에서와 마찬가지로 수를 세어 해당 지역에 몇 명이 살고 있는지 구해보자.

```sql
select address, count(address)
from address
group by address;
```

![](.SQL_자연언어를_사용하는_것처럼_images/094d0d72.png)

이전에 '홀 케이크를 혼자 먹지는 않을 것이다'라고 했는데, 혼자 먹는 경우도 있을 수 있다. SQL에서 이런 상황이 일어나면 어떻게 해야할까?
문제 없다. SQL에서도 케이크를 자르지 않고 그냥 먹어버릴 수 있다. 자르고 싶지 않다면 GROUP BY 구를 사용할 때 키를 지정하지 않으면 된다.
이렇게 하면 테이블 전체(= 케이크 전체)를 하나의 조각으로 생각해서 함수를 적용할 수 있다.

![](.SQL_자연언어를_사용하는_것처럼_images/afe8d6e7.png)

```sql
select count(*)
from address
group by ();
```

![](.SQL_자연언어를_사용하는_것처럼_images/61467e92.png)
GROUP BY 구의 '()'는 키를 지정하지 않는다는 뜻이다. 보통 이런 경우에는 GROUP BY 를 생략하는 경우가 많다.
하지만 '자르는 기준이 없다'라는 것을 명시적으로 지정하는 것이 의미적으로 좋긴 하다. 논리적으로 이해하기 쉽기 때문이다.

## HAVING 구

# 정리


