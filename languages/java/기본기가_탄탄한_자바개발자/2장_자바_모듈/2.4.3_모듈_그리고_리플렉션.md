<!-- Date: 2025-01-25 -->
<!-- Update Date: 2025-01-25 -->
<!-- File ID: 3c68651a-1f24-475a-83de-87358ea1018b -->
<!-- Author: Seoyeon Jang -->

# 개요
자바 8에서 개발자는 리플렉션을 사용하여 런타임의 거의 모든 것에 접근할 수 있다. 심지어 자바의 접근 제어 검사를 우회하여 다른 클래스의 비공개 메서드를 호출하는 방법도 있다.(예: `setAccessible()` 기법)

이미 살펴본 것처럼 모듈은 접근 제어 규칙을 변경한다. 이는 리플렉션에도 적용되는데, 기본적으로 내보내진 패키지만 리플렉션을 통해 접근해야한다는 것이 그 취지다.

그러나 모듈 시스템 개발자는 개발자에게 특정 패키지에 직접 액세스가 아닌 리플렉션을 통해 액세스가 필요할 때가 있다는 사실을 깨달았다. 이를 위해서는 명시적인 권한이 필요하며 `opens` 키워드를 사용해서 내부 패키지에 대한 리플렉션 전용 액세스를 제공한다. 개발자는 또한 `opens ... to ...` 구문을 사용해서 세분화된 액세스를 지정할 수 있는데, 명명된 패킺 집합이 특정 모듈을 리플렉션으로 열리게끔 허용할 수 있지만 더 일반적으로는 허용하지 않을 수 있다.

음? 그렇다면 이것은 이제 이러한 타입의 리플렉션을 활용한 트릭이 배제됐음을 암시하는 것처럼 보인다... 진실은 조금 더 복잡한데, 명령줄 스위치 `--illegal-access` 에 대한 논의를 통해 가장 잘 설명할 수 있다. 이 스위치는 `permit|warn|deny` 세가지 설정이 있으며, 리플렉션 검사의 엄격함 정도를 정하는 데 사용된다.

모듈 시스템의 의도는 시간이 지남에 따라 전체 자바 생태계가 올바른 캡슐화(리플렉션 포함)를 향해 진화해야 한다는 것이고, 어느 시점에는 이 스위치가 기본적으로 `deny`로 설정되고 최종적으로는 제거될 것이라는 것이다. 리플렉션 스위치가 갑자가 deny로 설정되면 자바 생태계의 상당 부분이 중단되고 '아무도 업그레이드하지 않을 것'이기 때문에 이러한 변화는 단기간에 일어날 수 없다.

![](.2.4.3_모듈_그리고_리플렉션_images/fecfbd97.png)

그러나 자바 17이 출시되면서 자바 9출시 후 이 같은 경고가 나온지도 4년이 넘게 지났다. 이정도면 충분한 시간이고 적당한 경고로도 충분하다. 이에 따라 자바 16에서는 --illegal-access 의 기본 옵션을 deny 로 변경하고 자바 17에서는 이 옵션의 효과를 완전히 제거하기로 결정했다.

>NOTE: 리플렉션 캡슐화에 대한 이러한 변경은 8에서 17로 바로 마이그레이션하는 애플리케이션이 두 번의 업그레이드(8 -> 11 -> 17)를 수행하는 애플리케이션보다 더 많은 문제를 겪을 수 있는 이유 중 하나다.

여전히 --add-opens 명령줄 옵션이나 JAR 파일의 매니페스트 속성 Add-Opens 를 사용해서 특정 패키지를 열 수 있다. 이 옵션은 리플렉션에 크게 의지하거나 아직 완전히 모듈화되지 않은 특정 라이브러리나 프레임워크에 필요할 수 있다. 그러나 전역적으로 액세스를 다시 활성화시키는 무차별 대입 옵션은 자바 17에서 제거됐다.

이러한 전환에 도움이 되는 또 하나의 유용한 개념은 개방형 모듈(open module)이다. 이 간단한 선언은 완전히 개방된 리플렉션을 통한 액세스를 허용하는 데 사용되며, 모든 모듈의 패키지를 열어 리플렉션을 통한 액세스를 허용하지만 컴파일 시의 액세스는 허용하지 않는다. 이는 기존 코드 및 프레임워크와의 간단한 호환성을 제공하지만 더 느슨한 형태의 캡슐화다. 따라서 모듈식 빌드로 마이그레이션할 때 오픈 모듈을 사용하지 않거나 과도기적인 형태로만 사용하는 것이 가장 좋다.

17장에서는 모듈식 세계에서 리플렉션의 몇 가지 문제점을 보여주는 좋은 예인 Unsafe 의 구체적인 사례에 대해 살펴본다.

# 정리


