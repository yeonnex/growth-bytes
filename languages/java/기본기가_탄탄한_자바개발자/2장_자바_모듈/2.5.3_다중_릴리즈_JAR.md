<!-- Date: 2025-01-25 -->
<!-- Update Date: 2025-01-26 -->
<!-- File ID: f22e8fe2-f4d2-4c82-b7f4-ee5d46c95970 -->
<!-- Author: Seoyeon Jang -->

# 개요

## 시나리오: "웹 애플리케이션 업그레이드"

### 배경

A사는 오래된 웹 애플리케이션을 운영하고 있음. 이 애플리케이션은 자바 8환경에서 실행되고 있으며, Spring Framework 4.x를 사용하고 있음 최근 회사는 Java 11로 업그레이드를 계획하고 있고, 이를
위해 새로운 기능을 추가하려 함.

하지만 애플리케이션의 핵심 비즈니스 로직과 외부 라이브러리의 중 일부는 아직 자바 8에 최적화되어있어 당장 자바 11로 전체 시스템을 변경하는 것이 어려움. 또한 자바 8에서 사용하던 라이브러리 중 일부는 자바
11에서 호환되지 않거나 성능 문제를 일으킬 수 있어 이를 해결하는 방법이 필요함.

### 문제

1. 외부 라이브러리 호환성: 애플리케이션에서 사용하던 `XLib`라는 외부 라이브러리는 자바 8에서는 잘 동작하지만, 자바 11에서는 성능 저하나 호환성 문제가 발생
2. 자바 11의 새로운 기능 활용: 자바 11에서 제공하는 HTTP Client API와 같은 새로운 기능을 사용하고 싶지만, 자바 8에서는 이 API가 없어서 사용할 수 없음

### 해결책: 다중 릴리즈 JAR 사용

A사는 다중 릴리즈 JAR를 사용하여 문제를 해결한다. 이렇게 하면 자바 8과 자바 11에서 각각 최적화된 코드와 라이브러리를 사용할 수 있게 된다.

#### 1. 기존 라이브러리와의 호환성 문제 해결

- XLib 라이브러리는 Java 8에서 잘 동작하지만, 자바 11에서 성능저하 발생
- 자바 8용 클래스를 그대로 두고, **Java 11용 XLib 버전**을 수정하여 성능 최적화
- META-INF/versions/11/ 디렉토리 아래에 Java11용 XLib 수정 버전을 두고, 자바 8에서는 기존 XLib 을 그대로 사용하도록 설정

#### 2. 자바 11의 새로운 기능 활용

- 자바 11에서는 새로운 HTTP Client API 가 도입됨. 자바 8에서는 이를 사용할 수 없으므로, 새로운 HTTP 클라이언트를 자바 11에서만 사용하도록 함
- 자바 8에서는 기존의 HTTPURLConnection을 사용하고, 자바 11에서는 새로운 HttpClient를 사용하도록, 해당 클래스를 `META-INF/versions/11` 디렉토리 안에 넣음.

#### 3. 다중 릴리즈 JAR 파일 구성

1. 클래스 파일 분리 관리
    - 컴파일 및 JAR 생성 시, 자바 8과 자바 11의 클래스를 완전히 분리해서 관리해야 한다.

2. 빌드 명령을 정확히 실행
    - 자바 8 코드 컴파일
   ```shell
    $ javac -d out --release 8 src/main/java/seoyeon/*.java
    ```
    - 자바 11 코드 컴파일
   ```shell
    $ javac -d out --release 11 versions/11/seoyeon/GetPID.java
    ```

#### 4. 다중 릴리즈 JAR 생성

**기본 JAR 생성**

먼저, 자바 8코드를 기반으로 JAR 파일을 생성한다.

```shell
$ jar --create --file seoyeon-multi-version.jar --main-class seoyeon.Main -C out .
```

**자바 11 전용 코드 추가**

그다음, 자바 11전용 코드를 다중 릴리즈 JAR에 추가한다.

```shell
$ jar --update --file seoyeon-multi-version.jar --release 11 -C out seoyeon/GetPID.class
```

### 결과 확인

자바 8과 11환경에서 jar 파일을 테스트해보자.

```shell
$ jenv local 1.8
$ java -version # 1.8
$ java -jar seoyeon-multi-version.jar

$ jenv local 11
$ java -version 11
$ java -jar seoyeon-multi-version.jar
```

## 결과 및 혜택

- 기존 시스템의 안전성 유지: 기존의 자바 8 시스템을 그대로 사용할 수 있고, 점진적으로 11을 도입할 수 있음
- 외부 라이브러리의 호환성 문제를 다중 릴리즈 JAR로 해결하고 자바 8과 11에서 각각 적합한 라이브러리 버전을 사용할 수 있게 됨

# 결론

A사는 다중 릴리즈 JAR를 사용하여 자바 8과 11에서 각각 최적화된 코드와 라이브러리를 사용할 수 있게 되었다. 이를 통해 애플리케이션의 점진적인 업그레이드를 지원하고, 외부 라이브러리 호환성 문제를 해결했다.
시스템을 전체적으로 업그레이드할 필요 없이, 버전별로 적합한 클래스를 선택적으로 실행할 수 있어 관리가 편리하고 효율적인 방식으로 시스템을 개선할 수 있다.

# 정리


